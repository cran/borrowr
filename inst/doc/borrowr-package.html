<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Estimating Population Average Treatment Effects with the borrowr Package</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Estimating Population Average Treatment Effects with the borrowr Package</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The borrowr package estimates the population average treatment effect (PATE) from a primary data source with borrowing from supplemental sources.</p>
<p>To adjust for confounding confounding, the estimation is done by fitting a model for the conditional mean given treatment and confounders. Currently, two models are available, a Bayesian linear model with an inverse-gamma prior, and Bayesian Additive Regression Trees (BART). The user must specify a formula for the conditional mean. This requires more thought for the Bayesian linear model as the analyst must carefully consider the functional form of the regression relationship. For BART, the right hand side of the formula need only include the confounders and the treatment variable without specification of the functional form.</p>
<p>Borrowing between data sources is done with <a href="https://www.ncbi.nlm.nih.gov/pubmed/29036300">Multisource Exchangeability Models</a> (MEMs; Kaizer et al., 2018) . MEMs borrow by assuming that each supplementary data source is either “exchangeable”, or not, with the primary data source. Two data sources are considered exchangeable if their model parameters are equal. Each data source can be exchangeable with the primary data, or not, so if there are <span class="math inline">\(r\)</span> data sources, there are <span class="math inline">\(2 ^ r\)</span> possible configurations regarding the exchangeability assumptions. Each of these configurations corresponds to a single MEM. The parameters for each MEM are estimated, and we compute a posterior probability for each. The posterior density of the PATE is a weighted posterior across all possible MEMs.</p>
</div>
<div id="the-adapt-data" class="section level2">
<h2>The <code>adapt</code> Data</h2>
<p>We illustrate usage of the <code>borrowr</code> package with the <code>adapt</code> data:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(borrowr)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">data</span>(adapt)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">head</span>(adapt)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt;           y        x  source treatment compliant</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; 1  86.51740 31.33148 Primary         0         1</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; 2 102.28575 61.68575 Primary         1         0</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; 3  90.59959 30.84199 Primary         0         1</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; 4  87.39230 29.58268 Primary         0         0</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt; 5  98.84180 49.49006 Primary         1         1</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt; 6  86.03576 24.80415 Primary         0         0</span></a></code></pre></div>
<p>The data include 3 data sources with a univariate confounding variable <code>x</code> and the treatment variable <code>treatment</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">ggplot</span>(<span class="dt">data =</span> adapt, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">color =</span> <span class="kw">as.factor</span>(treatment))) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>source) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="st">  </span><span class="kw">theme_classic</span>()</a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</span></a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --> We will estimate the PATE while adjusting for the confounding variable <code>x</code>.</p>
</div>
<div id="using-the-pate-function-to-estimate-the-pate" class="section level2">
<h2>Using the <code>pate</code> function to estimate the PATE</h2>
<p><code>pate</code> is the primary function of the borrowr package. The following arguments are <em>required</em>:</p>
<ul>
<li><code>formula</code>: a formula specifying the conditional mean model. It must include the treatment variable and the confounders. It should <em>not</em> include a variable indicating the data source.</li>
<li><code>estimator</code>: either <code>&quot;BART&quot;</code> or <code>bayesian_lm</code>. The default is <code>&quot;BART&quot;</code></li>
<li><code>src_var</code>: a character variable indicating which column of the data indicates the data source, e.g., source a, b, or c.</li>
<li><code>primary_source</code>: a character variable indicating which value of <code>src_var</code> is the primary data source.</li>
<li><code>trt_var</code>: a character variable indicating which column of the data indicates the treatment variable. This must be included in the formula, and <strong>it must be coded as 1 for treated and 0 for untreated</strong>.</li>
</ul>
<p>We will estimate the PATE using a quadratic model for <code>x</code>, allowing for different quadratic relationships between treated and untreated:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">est &lt;-<span class="st"> </span><span class="kw">pate</span>(y <span class="op">~</span><span class="st"> </span>treatment<span class="op">*</span>x <span class="op">+</span><span class="st"> </span>treatment<span class="op">*</span><span class="kw">I</span>(x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>), <span class="dt">data =</span> adapt, </a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="dt">estimator =</span> <span class="st">&quot;bayesian_lm&quot;</span>, <span class="dt">src_var =</span> <span class="st">&quot;source&quot;</span>, <span class="dt">primary_source =</span> <span class="st">&quot;Primary&quot;</span>, </a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="dt">trt_var =</span> <span class="st">&quot;treatment&quot;</span>)</a></code></pre></div>
<p>The <code>print</code> method shows some information about the posterior:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">est</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">#&gt; Population Average Treatment Effect (PATE)</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#&gt; Adjustment for confounding due to noncompliance:  No </span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&gt; PATE Posterior Summary Statistics (Treated minus Untreated):</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">#&gt; Mean Treatment Effect             Std. Dev.          Pr(PATE &gt; 0) </span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt;              8.041661              1.454188              1.000000</span></a></code></pre></div>
<p>And a summary method that gives more info:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">summary</span>(est)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt; Population Average Treatment Effect (PATE)</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">#&gt; pate(formula = y ~ treatment * x + treatment * I(x^2), estimator = &quot;bayesian_lm&quot;, </span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">#&gt;     data = adapt, src_var = &quot;source&quot;, primary_source = &quot;Primary&quot;, </span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">#&gt;     trt_var = &quot;treatment&quot;)</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">#&gt; Adjustment for confounding due to noncompliance:  No </span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">#&gt; PATE Posterior Summary Statistics (Treated minus Untreated):</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">#&gt; Mean Treatment Effect             Std. Dev.          Pr(PATE &gt; 0) </span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="co">#&gt;              8.041661              1.454188              1.000000 </span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-18" title="18"><span class="co">#&gt; Prior Probability of Exchangeability:</span></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-20" title="20"><span class="co">#&gt; Supp1 Supp2 </span></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co">#&gt;   0.5   0.5 </span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-23" title="23"><span class="co">#&gt; Exchangeability Matrix (1 == Exchangeable with primary source):</span></a>
<a class="sourceLine" id="cb5-24" title="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-25" title="25"><span class="co">#&gt;          MEM</span></a>
<a class="sourceLine" id="cb5-26" title="26"><span class="co">#&gt; source    1 2 3 4</span></a>
<a class="sourceLine" id="cb5-27" title="27"><span class="co">#&gt;   Primary 1 1 1 1</span></a>
<a class="sourceLine" id="cb5-28" title="28"><span class="co">#&gt;   Supp1   1 0 1 0</span></a>
<a class="sourceLine" id="cb5-29" title="29"><span class="co">#&gt;   Supp2   1 1 0 0</span></a>
<a class="sourceLine" id="cb5-30" title="30"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-31" title="31"><span class="co">#&gt; MEM Posterior Probability:</span></a>
<a class="sourceLine" id="cb5-32" title="32"><span class="co">#&gt;        MEM_1        MEM_2        MEM_3        MEM_4 </span></a>
<a class="sourceLine" id="cb5-33" title="33"><span class="co">#&gt; 2.205850e-02 8.850087e-02 8.894406e-01 3.509593e-10</span></a></code></pre></div>
<p>If treatment is randomly assigned but a causal estimator is needed due to noncompliant, use the <code>compliance_var</code> argument, and include the compliance indicator in the formula as appropriate:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">est2 &lt;-<span class="st"> </span><span class="kw">pate</span>(y <span class="op">~</span><span class="st"> </span>treatment <span class="op">+</span><span class="st"> </span>x<span class="op">*</span>compliant, </a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="dt">data =</span> adapt, <span class="dt">estimator =</span> <span class="st">&quot;bayesian_lm&quot;</span>, <span class="dt">src_var =</span> <span class="st">&quot;source&quot;</span>, <span class="dt">primary_source =</span> <span class="st">&quot;Primary&quot;</span>, <span class="dt">trt_var =</span> <span class="st">&quot;treatment&quot;</span>, <span class="dt">compliance_var =</span> <span class="st">&quot;compliant&quot;</span>)</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">summary</span>(est2)</a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">#&gt; Population Average Treatment Effect (PATE)</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#&gt; pate(formula = y ~ treatment + x * compliant, estimator = &quot;bayesian_lm&quot;, </span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">#&gt;     data = adapt, src_var = &quot;source&quot;, primary_source = &quot;Primary&quot;, </span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">#&gt;     trt_var = &quot;treatment&quot;, compliance_var = &quot;compliant&quot;)</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">#&gt; Adjustment for confounding due to noncompliance:  Yes </span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">#&gt; PATE Posterior Summary Statistics (Treated minus Untreated):</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="co">#&gt; Mean Treatment Effect             Std. Dev.          Pr(PATE &gt; 0) </span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co">#&gt;              2.538638              1.367084              1.000000 </span></a>
<a class="sourceLine" id="cb6-19" title="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="co">#&gt; Prior Probability of Exchangeability:</span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="co">#&gt; Supp1 Supp2 </span></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="co">#&gt;   0.5   0.5 </span></a>
<a class="sourceLine" id="cb6-24" title="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="co">#&gt; Exchangeability Matrix (1 == Exchangeable with primary source):</span></a>
<a class="sourceLine" id="cb6-26" title="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-27" title="27"><span class="co">#&gt;          MEM</span></a>
<a class="sourceLine" id="cb6-28" title="28"><span class="co">#&gt; source    1 2 3 4</span></a>
<a class="sourceLine" id="cb6-29" title="29"><span class="co">#&gt;   Primary 1 1 1 1</span></a>
<a class="sourceLine" id="cb6-30" title="30"><span class="co">#&gt;   Supp1   1 0 1 0</span></a>
<a class="sourceLine" id="cb6-31" title="31"><span class="co">#&gt;   Supp2   1 1 0 0</span></a>
<a class="sourceLine" id="cb6-32" title="32"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-33" title="33"><span class="co">#&gt; MEM Posterior Probability:</span></a>
<a class="sourceLine" id="cb6-34" title="34"><span class="co">#&gt;        MEM_1        MEM_2        MEM_3        MEM_4 </span></a>
<a class="sourceLine" id="cb6-35" title="35"><span class="co">#&gt; 0.0004947820 0.8759402596 0.1234549637 0.0001099947</span></a></code></pre></div>
<p>To set the prior probability that a source is exchangeable with the primary source, use the <code>exch_prob</code> argument:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">est3 &lt;-<span class="st"> </span><span class="kw">pate</span>(y <span class="op">~</span><span class="st"> </span>treatment<span class="op">*</span>x <span class="op">+</span><span class="st"> </span>treatment<span class="op">*</span><span class="kw">I</span>(x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>), <span class="dt">data =</span> adapt, </a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="dt">estimator =</span> <span class="st">&quot;bayesian_lm&quot;</span>, <span class="dt">src_var =</span> <span class="st">&quot;source&quot;</span>, <span class="dt">primary_source =</span> <span class="st">&quot;Primary&quot;</span>, </a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="dt">trt_var =</span> <span class="st">&quot;treatment&quot;</span>, <span class="dt">exch_prob =</span> <span class="kw">c</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">3</span>, <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">8</span>))</a>
<a class="sourceLine" id="cb7-4" title="4"><span class="kw">summary</span>(est3)</a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">#&gt; Population Average Treatment Effect (PATE)</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">#&gt; pate(formula = y ~ treatment * x + treatment * I(x^2), estimator = &quot;bayesian_lm&quot;, </span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co">#&gt;     data = adapt, src_var = &quot;source&quot;, primary_source = &quot;Primary&quot;, </span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">#&gt;     exch_prob = c(1/3, 1/8), trt_var = &quot;treatment&quot;)</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">#&gt; Adjustment for confounding due to noncompliance:  No </span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="co">#&gt; PATE Posterior Summary Statistics (Treated minus Untreated):</span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="co">#&gt; Mean Treatment Effect             Std. Dev.          Pr(PATE &gt; 0) </span></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="co">#&gt;              8.364706              1.104946              1.000000 </span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="co">#&gt; Prior Probability of Exchangeability:</span></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-23" title="23"><span class="co">#&gt;     Supp1     Supp2 </span></a>
<a class="sourceLine" id="cb7-24" title="24"><span class="co">#&gt; 0.3333333 0.1250000 </span></a>
<a class="sourceLine" id="cb7-25" title="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-26" title="26"><span class="co">#&gt; Exchangeability Matrix (1 == Exchangeable with primary source):</span></a>
<a class="sourceLine" id="cb7-27" title="27"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-28" title="28"><span class="co">#&gt;          MEM</span></a>
<a class="sourceLine" id="cb7-29" title="29"><span class="co">#&gt; source    1 2 3 4</span></a>
<a class="sourceLine" id="cb7-30" title="30"><span class="co">#&gt;   Primary 1 1 1 1</span></a>
<a class="sourceLine" id="cb7-31" title="31"><span class="co">#&gt;   Supp1   1 0 1 0</span></a>
<a class="sourceLine" id="cb7-32" title="32"><span class="co">#&gt;   Supp2   1 1 0 0</span></a>
<a class="sourceLine" id="cb7-33" title="33"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-34" title="34"><span class="co">#&gt; MEM Posterior Probability:</span></a>
<a class="sourceLine" id="cb7-35" title="35"><span class="co">#&gt;        MEM_1        MEM_2        MEM_3        MEM_4 </span></a>
<a class="sourceLine" id="cb7-36" title="36"><span class="co">#&gt; 3.433153e-03 2.754829e-02 9.690186e-01 7.647189e-10</span></a></code></pre></div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>Chipman, H. &amp; McCulloch, R. (2010) BART: Bayesian additive regression trees. <em>Annals of Applied Statistics</em>, <strong>4</strong>(1): 266-298.</p>
<p>Kaizer, Alexander M., Koopmeiners, Joseph S., Hobbs, Brian P. (2018) Bayesian hierarchical modeling based on multisource exchangeability. <em>Biostatistics</em>, <strong>19</strong>(2): 169-184.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
